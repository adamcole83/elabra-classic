(function(a){a.fn.auth=function(g){var f=a(this),c=a.extend({},a.fn.auth.defaults,g);var e=function(){if(a(c.usernameID).val()===""){a(c.usernameID).focus()}else{a(c.passwordID).focus().val("")}};var b=function(h){a(c.dialogBox).html("<"+c.errorElement+' class="'+c.errorClass+'">'+h+"</"+c.errorElement+">").show();f.addClass("errChange");e()};var d=function(h){var i=a(h).position().left;a(h).addClass("errChange").animate({left:"-=10"},50,"easeOutBounce").animate({left:"+=20"},50,"easeOutBounce").animate({left:"-=10"},50,"easeOutBounce").animate({left:"+=20"},50,"easeOutBounce").animate({left:0},50,"easeOutBounce");e()};a(c.usernameID).focus();f.submit(function(){var i=f.find(c.usernameID).val(),h=f.find(c.passwordID).val();if(i===""||h===""){b(c.errorText);if(c.wiggleDialog===true){d(c.dialogBox)}if(c.wiggleForm===true){d(f)}}else{a(c.dialogBox).hide();a.ajax({type:"POST",url:c.useLDAP===true?c.xhrLDAP:c.xhrSQL,dataType:"json",data:f.serialize(),success:function(j){if(j===null){b("Username/password combination failed.");if(c.wiggleDialog===true){d(c.dialogBox)}if(c.wiggleForm===true){d(f)}}else{if(typeof j.error!=="undefined"){b("Error: "+j.error)}else{f.fadeOut(500,function(){var l=c.useLDAP===true?j.givenname:j.first_name,k=c.useLDAP===true?j.sn:j.last_name;f.empty();a("<"+c.welcomeElement+' class="'+c.welcomeClass+'"><span>Redirecting...<span><'+c.welcomeElement+">").appendTo(f);f.fadeIn(500);setTimeout(function(){window.location=c.redirect},1000)}).removeClass("errChange")}}}})}return false});f.find(c.forgotAnchor).bind({click:function(){var h=c.useLDAP===true?c.passwdLdap:c.passwdDb;a(c.bubbleDrop).stop(true).html("<span>"+h+"</span>").slideDown(400,"easeOutElastic").delay(5000).slideUp(400,"easeInElastic")}})};a.fn.auth.defaults={ldap:true,xhrLDAP:"/admin/includes/xhr/usersearch.ldap.php",xhrSQL:"/admin/includes/xhr/usersearch.sql.php",redirect:"index.php",usernameID:"#username",passwordID:"#password",useLDAP:true,dialogBox:"#dialog",dialogTop:40,dialogLeft:"+=0",errorClass:"error",errorElement:"p",errorText:"Authentication required.",welcomeElement:"p",welcomeClass:"welcome",boxReturnLeft:0,wiggleDialog:true,wiggleForm:true,forgotAnchor:"#retrievepwd",bubbleDrop:"#bubbledrop",passwdLdap:'Please contact the University of Missouri <a href="http://www.umsystem.edu/ums/departments/is/helpdesks.shtml">help desk</a> for password retrieval.',passwdDb:'Please contact the <a href="mailto:jenkinsac@health.missouri.edu">Office of Communications</a> for password retrieval.'}})(jQuery);